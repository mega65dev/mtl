
; ******** Source: main.asm
     1                          ; ***************************************************************************************************************
     2                          ; ***************************************************************************************************************
     3                          ;
     4                          ;      Name:       main.asm
     5                          ;      Purpose:    MTL Runtime
     6                          ;      Created:    26th December 2020
     7                          ;      Author:     Paul Robson (paul@robsons.org.uk)
     8                          ;
     9                          ; ***************************************************************************************************************
    10                          ; ***************************************************************************************************************
    11                          
    12                              !if target=1 {
    13                              !source "bootmega.asm"
    14                              } else {

; ******** Source: boottest.asm
     1                          ; ***************************************************************************************************************
     2                          ; ***************************************************************************************************************
     3                          ;
     4                          ;      Name:       boottest.asm
     5                          ;      Purpose:    MTL Runtime, testbed code.
     6                          ;      Created:    26th December 2020
     7                          ;      Author:     Paul Robson (paul@robsons.org.uk)
     8                          ;
     9                          ; ***************************************************************************************************************
    10                          ; ***************************************************************************************************************
    11                            
    12                                  *=$2020
    13  2020 03                         !byte   $03
    14  2021 78                         sei
    15  2022 4c2820                     jmp     start
    16                          
    17                          ; ***************************************************************************************************************
    18                          ;
    19                          ;											Print Character in A
    20                          ;
    21                          ; ***************************************************************************************************************
    22                          
    23                          PrintCharacter
    24  2025 4ceeff                     jmp     $FFEE
    25                          

; ******** Source: main.asm
    16                              }
    17                          
    18                          start
    19  2028 a200                       ldx     #0
    20  202a a92a                       lda     #42
    21  202c 8dc2ff                     sta     $FFC2
    22  202f bd2020             loop    lda     $2020,x
    23  2032 204220                     jsr     PrintHex
    24  2035 a920                       lda     #' '
    25  2037 202520                     jsr     PrintCharacter
    26  203a e8                         inx
    27  203b e020                       cpx     #32
    28  203d d0f0                       bne     loop        
    29                          halt
    30  203f 4c3f20                     jmp     halt
    31                          
    32                          PrintHex:        
    33  2042 48                         pha
    34  2043 4a                         lsr     
    35  2044 4a                         lsr     
    36  2045 4a                         lsr     
    37  2046 4a                         lsr     
    38  2047 204b20                     jsr     _PrintNibble
    39  204a 68                         pla
    40                          _PrintNibble:
    41  204b 48                         pha
    42  204c 290f                       and     #15
    43  204e c90a                       cmp     #10
    44  2050 9002                       bcc     +
    45  2052 6906                       adc     #6
    46                          +
    47  2054 6930                       adc     #48
    48  2056 202520                     jsr     PrintCharacter
    49  2059 68                         pla 
    50  205a 60                         rts
    51                          
    52                          
